<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sahihun</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Playpen+Sans:wght@400&family=Lato:wght@300;400&family=Montserrat:wght@600;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #FFC0B3;      
      --text-main: #522117; 
      --dark-panel: #111111;
      --panel-text: #FFFFFF;
      --transition-speed: 0.4s;
      --progress: 10%;
      /* Couleurs pour l'effet neumorphique */
      --neu-shadow-dark: rgba(0, 0, 0, 0.1);
      --neu-shadow-light: rgba(255, 255, 255, 0.5);
    }

    body.dark-mode {
      --bg: #111111;
      --text-main: var(--current-pastel); 
      --dark-panel: var(--current-pastel);
      --panel-text: #111111;
      --neu-shadow-dark: rgba(0, 0, 0, 0.6);
      --neu-shadow-light: rgba(255, 255, 255, 0.05);
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Lato', sans-serif;
      background-color: var(--bg);
      overflow: hidden;
      cursor: pointer;
      padding: 20px;
      text-align: center;
      transition: background-color var(--transition-speed) ease;
    }

    /* Logo Image Palestine avec Shadow */
    .logo-img {
      position: fixed;
      top: 35px;
      left: 35px;
      width: 55px;
      height: auto;
      z-index: 100;
      filter: drop-shadow(0 10px 8px rgba(0,0,0,0.2));
    }

    /* Header */
    .top-bar {
      position: fixed;
      top: 30px;
      right: 30px;
      display: flex;
      align-items: center;
      gap: 20px;
      z-index: 100;
    }

    /* Interrupteur Neumorphique (Style Image Ref) */
    .theme-switch {
      position: relative;
      width: 70px;
      height: 35px;
      background: var(--bg);
      border-radius: 50px;
      cursor: pointer;
      /* Ombre interne pour l'effet creusé */
      box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), 
                  inset -3px -3px 6px var(--neu-shadow-light);
      transition: background 0.3s;
    }
    
    .theme-switch .dot {
      position: absolute;
      top: 4px;
      left: 4px;
      width: 27px;
      height: 27px;
      background: var(--bg);
      border-radius: 50%;
      /* Ombre externe pour l'effet relief */
      box-shadow: 2px 2px 5px var(--neu-shadow-dark), 
                  -1px -1px 4px var(--neu-shadow-light);
      transition: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    body.dark-mode .theme-switch .dot { 
      transform: translateX(35px); 
    }

    .counter-badge {
      background-color: var(--dark-panel);
      color: var(--panel-text);
      padding: 8px 18px;
      border-radius: 12px;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: background-color 0.4s, color 0.4s;
    }

    /* BARRE DE PROGRESSION */
    .progress-fixed-wrapper {
      position: fixed;
      top: 130px;
      width: 90%;
      max-width: 600px;
      z-index: 50;
    }

    .progress-container {
      width: 100%;
      height: 34px;
      background: #2c2f33; 
      border-radius: 50px;
      padding: 4px;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.5);
      position: relative;
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: var(--progress);
      background-color: var(--text-main); 
      border-radius: 50px;
      transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
      position: relative;
      background-image: linear-gradient(to bottom, rgba(255,255,255,0.2) 0%, rgba(0,0,0,0.1) 100%);
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 4px;
      right: 10px;
      width: 20%;
      max-width: 40px;
      height: 5px;
      background: rgba(255, 255, 255, 0.35);
      border-radius: 10px;
    }

    /* Zone de texte */
    #hadith-container {
      max-width: 900px;
      z-index: 2;
      margin-top: 100px; 
    }

    .arabic { 
      font-family: 'Amiri', serif; 
      font-size: clamp(1.8rem, 5.5vw, 3.2rem); 
      color: var(--text-main); 
      line-height: 1.6; 
      direction: rtl; 
      margin-bottom: 25px;
      transition: color 0.4s, opacity 0.3s;
    }

    .french { 
      font-family: 'Playpen Sans', cursive; 
      font-size: clamp(1.1rem, 2.8vw, 1.7rem); 
      color: var(--text-main); 
      line-height: 1.5; 
      margin-bottom: 25px;
      transition: color 0.4s, opacity 0.3s;
    }

    .source { 
      font-family: 'Montserrat', sans-serif;
      font-size: 0.85rem; 
      color: var(--text-main);
      opacity: 0.7;
    }

    /* RESPONSIVE MOBILE */
    @media (max-width: 600px) {
      .logo-img { width: 45px; top: 15px; left: 15px; }
      .top-bar { top: 15px; right: 15px; gap: 10px; }
      .counter-badge { padding: 6px 12px; font-size: 0.75rem; }
      .theme-switch { width: 60px; height: 30px; }
      .theme-switch .dot { width: 22px; height: 22px; }
      body.dark-mode .theme-switch .dot { transform: translateX(30px); }
      
      .progress-fixed-wrapper { width: 75%; top: 100px; } 
      #hadith-container { 
        margin-top: 20px; /* Remonté significativement pour mobile */
      }
    }

    .diamond { 
      position: fixed; 
      width: 10px; height: 10px; 
      background: var(--text-main); 
      border-radius: 2px; 
      opacity: 0; 
      pointer-events: none; 
      animation: floatDiamond 3.5s ease-out forwards; 
    }
    @keyframes floatDiamond {
      0%   { opacity: 0; transform: translateY(0) rotate(45deg) scale(0.5); }
      20%  { opacity: 0.6; }
      100% { opacity: 0; transform: translateY(-100vh) rotate(405deg) scale(1.2); }
    }
  </style>
</head>
<body>

  <img src="https://static.vecteezy.com/system/resources/previews/022/121/552/original/palestine-flag-heart-3d-png.png" class="logo-img" alt="Palestine Heart">

  <div class="top-bar" onclick="event.stopPropagation()">
    <div class="theme-switch" id="theme-toggle" title="Mode Jour/Nuit">
      <div class="dot"></div>
    </div>
    <div class="counter-badge">Hadith #<span id="counter-number">1</span></div>
  </div>

  <div class="progress-fixed-wrapper">
    <div class="progress-container" id="progress-container">
        <div class="progress-fill" id="progress-bar"></div>
    </div>
  </div>

  <div id="hadith-container">
    <div id="arabic" class="arabic"></div>
    <div id="french" class="french"></div>
    <div id="source" class="source"></div>
  </div>

<script>
const palettes = [
  { bg: "#FFC0B3", text: "#522117" },
  { bg: "#E0FFE0", text: "#2F3B16" },
  { bg: "#CFF1FF", text: "#0C232E" },
  { bg: "#FFF2BF", text: "#3D370B" },
  { bg: "#FFCCF2", text: "#4A0E34" },
  { bg: "#E2C7FF", text: "#200936" }
];

let hadiths = [];
let currentIndex = 0;
let clickCount = 1;

const themeToggle = document.getElementById('theme-toggle');
themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
});

async function init() {
  try {
    const res = await fetch('./hadiths.json');
    hadiths = await res.json();
    hadiths.sort(() => Math.random() - 0.5);
    updateProgress();
    render();
  } catch (err) {
    document.getElementById('french').innerText = "Erreur de chargement du fichier JSON.";
  }
}

function updateProgress() {
    let currentStep = ((clickCount - 1) % 10) + 1;
    let percentage = currentStep * 10;
    document.documentElement.style.setProperty('--progress', `${percentage}%`);
}

function render() {
  if (!hadiths.length) return;
  const h = hadiths[currentIndex];
  const cp = palettes[Math.floor(Math.random() * palettes.length)];

  document.documentElement.style.setProperty('--bg', cp.bg);
  document.documentElement.style.setProperty('--text-main', cp.text);
  document.documentElement.style.setProperty('--current-pastel', cp.bg);

  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      const d = document.createElement('div');
      d.className = 'diamond';
      d.style.left = `${Math.random() * 100}vw`;
      d.style.top = `100vh`;
      d.style.background = (document.body.classList.contains('dark-mode')) ? cp.bg : cp.text;
      document.body.appendChild(d);
      d.addEventListener('animationend', () => d.remove());
    }, i * 100);
  }

  const elements = ['arabic', 'french', 'source'];
  elements.forEach(id => document.getElementById(id).style.opacity = 0);
  
  setTimeout(() => {
    document.getElementById('arabic').textContent = h.arabic;
    document.getElementById('french').textContent = `« ${h.french} »`;
    document.getElementById('source').innerHTML = `Source : <strong>${h.source}</strong>`;
    document.getElementById('counter-number').textContent = clickCount;
    elements.forEach(id => document.getElementById(id).style.opacity = 1);
    updateProgress();
  }, 200);
}

document.body.addEventListener('click', (e) => {
  if (e.target.closest('.top-bar')) return;
  clickCount++;
  currentIndex = (currentIndex + 1) % hadiths.length;
  if (currentIndex === 0) hadiths.sort(() => Math.random() - 0.5);
  render();
});

init();
</script>
</body>
</html>


